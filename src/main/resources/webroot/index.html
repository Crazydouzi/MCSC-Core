<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Language" content="UTF-8" />
    <title>Hello CommonJS!</title>
</head>
<body>
<body>
<div id="ta" style="overflow:auto;max-width:800px;max-height:300px"></div>
<br>
<input type="text" id="inp" value="" placeholder="input">
<input type="button" id="btn" value="发送" onclick="send()">
<input type="button" id="OpenBtn" value="建立连接" onclick="openSock()">
<input type="button" id="closeBtn" value="关闭" onclick="closeSock()">
</body>

<script src="./js/sockjs.min.js"></script>
<script>
    var  sock = new SockJS('http://localhost:8080/ws/server/process/');
    let textarea0 = document.getElementById("ta");
    sock.onmessage = d => {
        console.log(d.data);
        let p = document.createElement('p');
        p.innerText = d.data;
        textarea0.append(p);
        p = null;
        textarea0.scrollTop = textarea0.scrollHeight;
    };
    sock.onevent = function (event, message) {
        console.log('event: %o, message:%o', event, message);
        return true; // in order to signal that the message has been processed
    };

    sock.onunhandled = function (json) {
        console.log('this message has no address:', json);
    };

    function openSock() {
        sock = new SockJS('http://localhost:8080/ws/server/process/');
        sock.onopen = function () {
            console.log('open');
        };
        sock.onmessage = d => {
            console.log(d.data);
            let p = document.createElement('p');
            p.innerText = d.data;
            textarea0.append(p);
            p = null;
            textarea0.scrollTop = textarea0.scrollHeight;
        };
    }

    function closeSock() {
        sock.close();
        sock.onclose = function () {
            alert("Socket关闭")
            console.log('close');
        };

    }
    function send() {
        let comm = document.getElementById("inp");
        console.log(comm.value)
        sock.send(comm.value)
    }

</script>
</body>
</html>
